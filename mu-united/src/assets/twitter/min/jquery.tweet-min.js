!function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e(jQuery)}(function($){$.fn.tweet=function(e){function t(e,t){if("string"==typeof e){var r=e;for(var a in t){var n=t[a];r=r.replace(new RegExp("{"+a+"}","g"),null===n?"":n)}return r}return e(t)}function r(e,t){return function(){var r=[];return this.each(function(){r.push(this.replace(e,t))}),$(r)}}function a(e){return e.replace(/</g,"&lt;").replace(/>/g,"^&gt;")}function n(e,t){return e.replace(w,function(e){for(var r=/^[a-z]+:/i.test(e)?e:"http://"+e,n=e,i=0;i<t.length;++i){var s=t[i];if(s.url==r&&s.expanded_url){r=s.expanded_url,n=s.display_url;break}}return'<a href="'+a(r)+'">'+a(n)+"</a>"})}function i(e){return Date.parse(e.replace(/^([a-z]{3})( [a-z]{3} \d\d?)(.*)( \d{4})$/i,"$1,$2$4$3"))}function s(e){var t=arguments.length>1?arguments[1]:new Date,r=parseInt((t.getTime()-e)/1e3,10),a="";return a=1>r?"just now":60>r?r+" seconds ago":120>r?"about a minute ago":2700>r?"about "+parseInt(r/60,10).toString()+" minutes ago":7200>r?"about an hour ago":86400>r?"about "+parseInt(r/3600,10).toString()+" hours ago":172800>r?"about a day ago":"about "+parseInt(r/86400,10).toString()+" days ago"}function u(e){return e.match(/^(@([A-Za-z0-9-_]+)) .*/i)?c.auto_join_text_reply:e.match(w)?c.auto_join_text_url:e.match(/^((\w+ed)|just) .*/im)?c.auto_join_text_ed:e.match(/^(\w*ing) .*/i)?c.auto_join_text_ing:c.auto_join_text_default}function o(){var e=c.modpath,t=null===c.fetch?c.count:c.fetch,r={include_entities:1};if(c.list)return{host:c.twitter_api_url,url:"/1.1/lists/statuses.json",parameters:$.extend({},r,{list_id:c.list_id,slug:c.list,owner_screen_name:c.username,page:c.page,count:t,include_rts:c.retweets?1:0})};if(c.favorites)return{host:c.twitter_api_url,url:"/1.1/favorites/list.json",parameters:$.extend({},r,{list_id:c.list_id,screen_name:c.username,page:c.page,count:t})};if(null===c.query&&1===c.username.length)return{host:c.twitter_api_url,url:"/1.1/statuses/user_timeline.json",parameters:$.extend({},r,{screen_name:c.username,page:c.page,count:t,include_rts:c.retweets?1:0})};var a=c.query||"from:"+c.username.join(" OR from:");return{host:c.twitter_search_url,url:"/1.1/search/tweets.json",parameters:$.extend({},r,{q:a,count:t})}}function _(e,t){return t?"user"in e?e.user.profile_image_url_https:_(e,!1).replace(/^http:\/\/[a-z0-9]{1,3}\.twimg\.com\//,"https://s3.amazonaws.com/twitter_production/"):e.profile_image_url||e.user.profile_image_url}function l(e){var r={};return r.item=e,r.source=e.source,r.name=e.from_user_name||e.user.name,r.screen_name=e.from_user||e.user.screen_name,r.avatar_size=c.avatar_size,r.avatar_url=_(e,"https:"===document.location.protocol),r.retweet="undefined"!=typeof e.retweeted_status,r.tweet_time=i(e.created_at),r.join_text="auto"==c.join_text?u(e.text):c.join_text,r.tweet_id=e.id_str,r.twitter_base="http://"+c.twitter_url+"/",r.user_url=r.twitter_base+r.screen_name,r.tweet_url=r.user_url+"/status/"+r.tweet_id,r.reply_url=r.twitter_base+"intent/tweet?in_reply_to="+r.tweet_id,r.retweet_url=r.twitter_base+"intent/retweet?tweet_id="+r.tweet_id,r.favorite_url=r.twitter_base+"intent/favorite?tweet_id="+r.tweet_id,r.retweeted_screen_name=r.retweet&&e.retweeted_status.user.screen_name,r.tweet_relative_time=s(r.tweet_time),r.entities=e.entities?(e.entities.urls||[]).concat(e.entities.media||[]):[],r.tweet_raw_text=r.retweet?"RT @"+r.retweeted_screen_name+" "+e.retweeted_status.text:e.text,r.tweet_text=$([n(r.tweet_raw_text,r.entities)]).linkUser().linkHash()[0],r.tweet_text_fancy=$([r.tweet_text]).makeHeart()[0],r.user=t('<a class="tweet_user" href="{user_url}">{screen_name}</a>',r),r.join=c.join_text?t(' <span class="tweet_join">{join_text}</span> ',r):" ",r.avatar=r.avatar_size?t('<a class="tweet_avatar" href="{user_url}"><img src="{avatar_url}" height="{avatar_size}" width="{avatar_size}" alt="{screen_name}\'s avatar" title="{screen_name}\'s avatar" border="0"/></a>',r):"",r.time=t('<span class="tweet-time"><a href="{tweet_url}" title="view tweet on twitter">{tweet_relative_time}</a></span>',r),r.text=t('<span class="tweet-text">{tweet_text_fancy}</span>',r),r.reply_action=t('<a class="tweet_action tweet_reply" href="{reply_url}">reply</a>',r),r.retweet_action=t('<a class="tweet_action tweet_retweet" href="{retweet_url}">retweet</a>',r),r.favorite_action=t('<a class="tweet_action tweet_favorite" href="{favorite_url}">favorite</a>',r),r}var c=$.extend({modpath:"twitter/",username:null,list_id:null,list:null,favorites:!1,query:null,avatar_size:null,count:3,fetch:null,page:1,retweets:!0,intro_text:null,outro_text:null,join_text:null,auto_join_text_default:"i said,",auto_join_text_ed:"i",auto_join_text_ing:"i am",auto_join_text_reply:"i replied to",auto_join_text_url:"i was looking at",loading_text:null,refresh_interval:null,twitter_url:"twitter.com",twitter_api_url:"api.twitter.com",twitter_search_url:"api.twitter.com",template:"{text}{time}",comparator:function(e,t){return t.tweet_time-e.tweet_time},filter:function(e){return!0}},e),w=/\b((?:[a-z][\w-]+:(?:\/{1,3}|[a-z0-9%])|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,4}\/)(?:[^\s()<>]+|\(([^\s()<>]+|(\([^\s()<>]+\)))*\))+(?:\(([^\s()<>]+|(\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))/gi;return $.extend({tweet:{t:t}}),$.fn.extend({linkUser:r(/(^|[\W])@(\w+)/gi,'$1<span class="at">@</span><a href="http://'+c.twitter_url+'/$2">$2</a>'),linkHash:r(/(?:^| )[\#]+([\w\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u00ff\u0600-\u06ff]+)/gi,' <a href="https://twitter.com/search?q=%23$1'+(c.username&&1==c.username.length&&!c.list?"&from="+c.username.join("%2BOR%2B"):"")+'" class="tweet_hashtag">#$1</a>'),makeHeart:r(/(&lt;)+[3]/gi,"<tt class='heart'>&#x2665;</tt>")}),this.each(function(e,r){var a=$('<div class="tweet-list">'),n='<p class="tweet-intro">'+c.intro_text+"</p>",i='<p class="tweet-outro">'+c.outro_text+"</p>",s=$('<p class="loading">'+c.loading_text+"</p>");c.username&&"string"==typeof c.username&&(c.username=[c.username]),$(r).unbind("tweet:load").bind("tweet:load",function(){c.loading_text&&$(r).empty().append(s),$.ajax({dataType:"json",type:"post",async:!1,url:c.modpath||"/twitter/",data:{request:o()},success:function(e,s){e.message&&console.log(e.message);var u=e.response;$(r).empty().append(a),c.intro_text&&a.before(n),a.empty(),resp=void 0!==u.statuses?u.statuses:void 0!==u.results?u.results:u;var o=$.map(resp,l);o=$.grep(o,c.filter).sort(c.comparator).slice(0,c.count),a.append($.map(o,function(e){return'<div class="tweet">'+t(c.template,e)+"</div>"}).join("")).children("div:first").addClass("tweet-first").end().children("div:odd").addClass("tweet-even").end().children("div:even").addClass("tweet-odd"),c.outro_text&&a.after(i),$(r).trigger("loaded").trigger(o?"empty":"full"),c.refresh_interval&&window.setTimeout(function(){$(r).trigger("tweet:load")},1e3*c.refresh_interval)}})}).trigger("tweet:load")})}});